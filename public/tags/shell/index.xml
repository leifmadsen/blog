<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Shell on Asterisk, and other worldly endeavours</title>
    <link>http://blog.leifmadsen.com/tags/shell/</link>
    <description>Recent content in Shell on Asterisk, and other worldly endeavours</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 09 Sep 2015 21:20:40 +0000</lastBuildDate>
    <atom:link href="http://blog.leifmadsen.com/tags/shell/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Configuring powerline to show working Git branch</title>
      <link>http://blog.leifmadsen.com/blog/2015/09/09/configuring-powerline-to-show-working-git-branch/</link>
      <pubDate>Wed, 09 Sep 2015 21:20:40 +0000</pubDate>
      
      <guid>http://blog.leifmadsen.com/blog/2015/09/09/configuring-powerline-to-show-working-git-branch/</guid>
      <description>&lt;p&gt;So the documentation for &lt;a href=&#34;http://powerline.readthedocs.org/en/latest/index.html&#34;&gt;Powerline&lt;/a&gt;Â kind of sucks. I followed &lt;a href=&#34;http://fedoramagazine.org/add-power-terminal-powerline&#34;&gt;this&lt;/a&gt; pretty good article on getting started with it. First thing I noticed however is that the &lt;code&gt;if&lt;/code&gt; statement on the article doesn&amp;rsquo;t work if you don&amp;rsquo;t have powerline installed (which kind of defeats the purpose of having the &lt;code&gt;if&lt;/code&gt; statement there at all).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# if powerline is installed, then use it
command -v powerline-daemon &amp;amp;&amp;gt;/dev/null
if [ $? -eq 0 ]; then
powerline-daemon -q
POWERLINE_BASH_CONTINUATION=1
POWERLINE_BASH_SELECT=1
. /usr/share/powerline/bash/powerline.sh
fi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Next up is the configuration. I primarily use my bash prompt as a way to indicate which branch I&amp;rsquo;m working in within a Git repository. You need to point at the &lt;code&gt;default_leftonly&lt;/code&gt; theme which is pretty easy to find when you web search for it. The issue is everything seems to just point you at the powerline docs, which aren&amp;rsquo;t the most clear.&lt;/p&gt;

&lt;p&gt;First, start by creating a local configuration directory that will override the configuration for powerline for your user.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ mkdir -p ~/.config/powerline
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then the next thing is to copy over the &lt;code&gt;config.json&lt;/code&gt; from the main powerline configuration directory where you can find the available color schemes and other shell, i3, vim, etc themes.&lt;/p&gt;

&lt;p&gt;(Again, the documentation kind of sucks on where the root of these configurations live&amp;hellip;)&lt;/p&gt;

&lt;p&gt;On my Fedora 22 system they live in &lt;code&gt;/etc/xdg/powerline/&lt;/code&gt;. I then copy the &lt;code&gt;config.json&lt;/code&gt; from that directory to &lt;code&gt;~/.config/powerline&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To get the Git branch stuff going, I modified the configuration file in the following way:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;--- /etc/xdg/powerline/config.json 2015-02-18 18:56:51.000000000 -0500
+++ /home/lmadsen/.config/powerline/config.json 2015-09-09 17:11:43.937522571 -0400
@@ -18,7 +18,7 @@
},
&amp;quot;shell&amp;quot;: {
&amp;quot;colorscheme&amp;quot;: &amp;quot;default&amp;quot;,
- &amp;quot;theme&amp;quot;: &amp;quot;default&amp;quot;,
+ &amp;quot;theme&amp;quot;: &amp;quot;default_leftonly&amp;quot;,
&amp;quot;local_themes&amp;quot;: {
&amp;quot;continuation&amp;quot;: &amp;quot;continuation&amp;quot;,
&amp;quot;select&amp;quot;: &amp;quot;select&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To make it active you can run &lt;code&gt;powerline-config --reload&lt;/code&gt;. If you have any errors in your configuration (I actually ran into this when playing with the colorscheme setting and used &amp;ldquo;solorized&amp;rdquo; instead of &amp;ldquo;solarized&amp;rdquo;), you can check it with &lt;code&gt;powerline-lint&lt;/code&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>HowTo: Read a value from a file, and say it back</title>
      <link>http://blog.leifmadsen.com/blog/2009/07/17/howto-read-a-value-from-a-file-and-say-it-back/</link>
      <pubDate>Fri, 17 Jul 2009 17:21:15 +0000</pubDate>
      
      <guid>http://blog.leifmadsen.com/blog/2009/07/17/howto-read-a-value-from-a-file-and-say-it-back/</guid>
      <description>

&lt;h3 id=&#34;preamble:0d635cd39416ed1b6422f4dcd67cbe23&#34;&gt;Preamble&lt;/h3&gt;

&lt;p&gt;Today on the &lt;a href=&#34;http://www.voipusersconference.org/&#34;&gt;VoIP Users Conference&lt;/a&gt; we discussed my request for recipe ideas in order to start developing some additional documentation. Specifically, I&amp;rsquo;m looking for problems that are simple, common problems that can be solved in the dialplan, and which are good examples of the dialplan language (markup, script, yadda yadda).&lt;/p&gt;

&lt;p&gt;One of the suggestions was something posted to the Asterisk mailing list which was pretty straight forward: to read in the contents of a file, where the file contained a number which was the current temperature. This file was created by an external script, and the poster was looking for how to read in the contents of that file, and play back something that would say the number, followed by &amp;ldquo;degrees&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;The discussion delved into some possible solutions, and delved into the problem with writing Asterisk recipes in general; that there are always several ways to skin the same cat. Below I will mention some of the examples that had come up on the conference call in the Discussion section, and will then show a dialplan (that works on Asterisk 1.4) that will solve the problem proposed in the Solution section.&lt;/p&gt;

&lt;h3 id=&#34;problem:0d635cd39416ed1b6422f4dcd67cbe23&#34;&gt;Problem&lt;/h3&gt;

&lt;p&gt;To read the contents of a file, where the contents will contain a number, that needs to be read back to the caller, followed by the word &amp;ldquo;degrees&amp;rdquo;.&lt;/p&gt;

&lt;h3 id=&#34;solution:0d635cd39416ed1b6422f4dcd67cbe23&#34;&gt;Solution&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;[subSayCurrentTemperature]
exten =&amp;gt; start,1,Verbose(2,Saying the current temperature back to channel ${CHANNEL})

; first, lets verify the the file exists for reading in data
exten =&amp;gt; start,n,Set(PATH_TO_FILE=/tmp/current_temp.txt)
exten =&amp;gt; start,n,Set(FILE_STATUS=${STAT(e,${PATH_TO_FILE})})
exten =&amp;gt; start,n,GotoIf($[&amp;quot;${FILE_STATUS}&amp;quot; = &amp;quot;&amp;quot; | &amp;quot;${FILE_STATUS}&amp;quot; = &amp;quot;0&amp;quot;]?no_file,1)

; next lets read in the value from the file since it exists
exten =&amp;gt; start,n,Set(MAX_FILE_CHARACTERS=256)
exten =&amp;gt; start,n,ReadFile(TEMPERATURE=${PATH_TO_FILE},${MAX_FILE_CHARACTERS})
exten =&amp;gt; start,n,GotoIf($[${ISNULL(${TEMPERATURE})}]?no_file,1)                               ; verify we got a value

; say the temperature
exten =&amp;gt; start,n,Playback(silence/1)
exten =&amp;gt; start,n,SayNumber(${TEMPERATURE})
exten =&amp;gt; start,n,Playback(en/degrees&amp;amp;en;/fahrenheit)
exten =&amp;gt; start,n,Return()

exten =&amp;gt; no_file,1,Verbose(2,File does not exist)
exten =&amp;gt; no_file,n,Playback(silence/1)
exten =&amp;gt; no_file,n,Playback(en/feature-not-avail-line)
exten =&amp;gt; no_file,n,Return()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And then you can setup some sort of test number that will call the subroutine (I&amp;rsquo;m using &lt;code&gt;GoSub()&lt;/code&gt;).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[incoming]
exten =&amp;gt; 555,1,Verbose(2,Checking temperature)
exten =&amp;gt; 555,n,GoSub(subSayCurrentTemperature,start,1)
exten =&amp;gt; 555,n,Hangup()
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;discussion:0d635cd39416ed1b6422f4dcd67cbe23&#34;&gt;Discussion&lt;/h3&gt;

&lt;p&gt;The solution above is really the &amp;ldquo;right&amp;rdquo; way to do it in Asterisk. But with Asterisk, there always seems to be many &amp;ldquo;right&amp;rdquo; ways to solve the same solution. Because the problem was to read in the contents of a file and to say the contents back, then the solution I provided certainly solves that problem directly in dialplan without any external scripts, or dropping to the console.&lt;/p&gt;

&lt;p&gt;There were several other solutions that could have been provided for this solution since there was an external PHP script that was generating the file and its contents. That script could have done any of the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Execute a shell command, and write the contents to the Asterisk database: &lt;code&gt;asterisk -rx &amp;quot;database put temperature current 60&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Write the contents to a relational database such as MySQL and use func_odbc:  &lt;code&gt;Set(TEMPERATURE=${ODBC_TEMP()})&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Setup a webpage and parse it with curl: &lt;code&gt;Set(TEMPERATURE=${CURL(http://website.tld/temperature.php)})&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;On Asterisk 1.6, there is the SHELL() function: &lt;code&gt;Set(TEMPERATURE=${SHELL(cat /tmp/current_temperature.txt)})&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I particularly like the curl solution since it allows the script to lookup the temperature when the CURL() function calls it, which means it can be real time and not delayed like writing to a text file can be.&lt;/p&gt;

&lt;p&gt;So like with all things Asterisk, there are always many inventive ways to solve the same solution.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>