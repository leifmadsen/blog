<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Curl on Asterisk, and other worldly endeavours</title>
    <link>http://blog.leifmadsen.com/tags/curl/</link>
    <description>Recent content in Curl on Asterisk, and other worldly endeavours</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 27 Feb 2011 21:57:41 +0000</lastBuildDate>
    <atom:link href="http://blog.leifmadsen.com/tags/curl/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Using #exec to set externaddr in sip.conf</title>
      <link>http://blog.leifmadsen.com/blog/2011/02/27/using-</link>
      <pubDate>Sun, 27 Feb 2011 21:57:41 +0000</pubDate>
      
      <guid>http://blog.leifmadsen.com/blog/2011/02/27/using-</guid>
      <description>&lt;p&gt;Today I was working on a system, and knowing that the system is going to get moved, and that often one of the things forgotten is to update the &lt;strong&gt;externaddr=&lt;/strong&gt; option in &lt;em&gt;sip.conf&lt;/em&gt; (when Asterisk is sitting behind NAT), I decided to put together a little script that returns the external IP address of the system. Using this script along with an &lt;strong&gt;#exec&lt;/strong&gt; in the &lt;em&gt;sip.conf&lt;/em&gt; file will make it so the address gets updated when the system is moved to the new physical location. I used the &lt;em&gt;php5-curl&lt;/em&gt; package on Ubuntu. I used the example from this page for cURL: &lt;a href=&#34;http://www.php.net/manual/en/curl.examples-basic.php&#34;&gt;http://www.php.net/manual/en/curl.examples-basic.php&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is the PHP script:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;#!/usr/bin/php
&amp;lt;?php

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, &amp;quot;http://getip.krisk.org&amp;quot;);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
$output = curl_exec($ch);
curl_close($ch);

echo &amp;quot;externaddr=&amp;quot;.$output.&amp;quot;\n&amp;quot;;

?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And the Asterisk configuration required &lt;em&gt;asterisk.conf&lt;/em&gt; to be modified. Enable the &lt;em&gt;execincludes=yes&lt;/em&gt; option, and then add the following to the &lt;strong&gt;[general]&lt;/strong&gt; section of &lt;em&gt;sip.conf&lt;/em&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#exec /etc/asterisk/scripts/set_externaddr.php
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Video of &#39;5 Things You Didn&#39;t Know Asterisk Could Do&#39; Presentation Now Available</title>
      <link>http://blog.leifmadsen.com/blog/2010/12/21/video-of-5-things-you-didnt-know-asterisk-could-do-presentation-now-available/</link>
      <pubDate>Tue, 21 Dec 2010 15:26:43 +0000</pubDate>
      
      <guid>http://blog.leifmadsen.com/blog/2010/12/21/video-of-5-things-you-didnt-know-asterisk-could-do-presentation-now-available/</guid>
      <description>&lt;p&gt;Check out the &lt;a href=&#34;http://www.astricon.net&#34;&gt;AstriCon&lt;/a&gt; website for my presentation that was recorded this year. I did three presentations this year (5 Things You Didn&amp;rsquo;t Know Asterisk Could Do, Distributed Call Centres, and the Asterisk Project Update with &lt;a href=&#34;http://www.russellbryant.net&#34;&gt;Russell Bryant&lt;/a&gt;) but unfortunately the only one I see so far is the 5 Things presentation (which is a very good presentation! :))&lt;/p&gt;

&lt;p&gt;The link to the presentations are here:Â &lt;a href=&#34;http://www.astricon.net/videoPresentations.aspx#Digium7&#34;&gt;http://www.astricon.net/videoPresentations.aspx#Digium7&lt;/a&gt; with mine being at the top of the list.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>HowTo: Read a value from a file, and say it back</title>
      <link>http://blog.leifmadsen.com/blog/2009/07/17/howto-read-a-value-from-a-file-and-say-it-back/</link>
      <pubDate>Fri, 17 Jul 2009 17:21:15 +0000</pubDate>
      
      <guid>http://blog.leifmadsen.com/blog/2009/07/17/howto-read-a-value-from-a-file-and-say-it-back/</guid>
      <description>

&lt;h3 id=&#34;preamble&#34;&gt;Preamble&lt;/h3&gt;

&lt;p&gt;Today on the &lt;a href=&#34;http://www.voipusersconference.org/&#34;&gt;VoIP Users Conference&lt;/a&gt; we discussed my request for recipe ideas in order to start developing some additional documentation. Specifically, I&amp;rsquo;m looking for problems that are simple, common problems that can be solved in the dialplan, and which are good examples of the dialplan language (markup, script, yadda yadda).&lt;/p&gt;

&lt;p&gt;One of the suggestions was something posted to the Asterisk mailing list which was pretty straight forward: to read in the contents of a file, where the file contained a number which was the current temperature. This file was created by an external script, and the poster was looking for how to read in the contents of that file, and play back something that would say the number, followed by &amp;ldquo;degrees&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;The discussion delved into some possible solutions, and delved into the problem with writing Asterisk recipes in general; that there are always several ways to skin the same cat. Below I will mention some of the examples that had come up on the conference call in the Discussion section, and will then show a dialplan (that works on Asterisk 1.4) that will solve the problem proposed in the Solution section.&lt;/p&gt;

&lt;h3 id=&#34;problem&#34;&gt;Problem&lt;/h3&gt;

&lt;p&gt;To read the contents of a file, where the contents will contain a number, that needs to be read back to the caller, followed by the word &amp;ldquo;degrees&amp;rdquo;.&lt;/p&gt;

&lt;h3 id=&#34;solution&#34;&gt;Solution&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;[subSayCurrentTemperature]
exten =&amp;gt; start,1,Verbose(2,Saying the current temperature back to channel ${CHANNEL})

; first, lets verify the the file exists for reading in data
exten =&amp;gt; start,n,Set(PATH_TO_FILE=/tmp/current_temp.txt)
exten =&amp;gt; start,n,Set(FILE_STATUS=${STAT(e,${PATH_TO_FILE})})
exten =&amp;gt; start,n,GotoIf($[&amp;quot;${FILE_STATUS}&amp;quot; = &amp;quot;&amp;quot; | &amp;quot;${FILE_STATUS}&amp;quot; = &amp;quot;0&amp;quot;]?no_file,1)

; next lets read in the value from the file since it exists
exten =&amp;gt; start,n,Set(MAX_FILE_CHARACTERS=256)
exten =&amp;gt; start,n,ReadFile(TEMPERATURE=${PATH_TO_FILE},${MAX_FILE_CHARACTERS})
exten =&amp;gt; start,n,GotoIf($[${ISNULL(${TEMPERATURE})}]?no_file,1)                               ; verify we got a value

; say the temperature
exten =&amp;gt; start,n,Playback(silence/1)
exten =&amp;gt; start,n,SayNumber(${TEMPERATURE})
exten =&amp;gt; start,n,Playback(en/degrees&amp;amp;en;/fahrenheit)
exten =&amp;gt; start,n,Return()

exten =&amp;gt; no_file,1,Verbose(2,File does not exist)
exten =&amp;gt; no_file,n,Playback(silence/1)
exten =&amp;gt; no_file,n,Playback(en/feature-not-avail-line)
exten =&amp;gt; no_file,n,Return()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And then you can setup some sort of test number that will call the subroutine (I&amp;rsquo;m using &lt;code&gt;GoSub()&lt;/code&gt;).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[incoming]
exten =&amp;gt; 555,1,Verbose(2,Checking temperature)
exten =&amp;gt; 555,n,GoSub(subSayCurrentTemperature,start,1)
exten =&amp;gt; 555,n,Hangup()
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;discussion&#34;&gt;Discussion&lt;/h3&gt;

&lt;p&gt;The solution above is really the &amp;ldquo;right&amp;rdquo; way to do it in Asterisk. But with Asterisk, there always seems to be many &amp;ldquo;right&amp;rdquo; ways to solve the same solution. Because the problem was to read in the contents of a file and to say the contents back, then the solution I provided certainly solves that problem directly in dialplan without any external scripts, or dropping to the console.&lt;/p&gt;

&lt;p&gt;There were several other solutions that could have been provided for this solution since there was an external PHP script that was generating the file and its contents. That script could have done any of the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Execute a shell command, and write the contents to the Asterisk database: &lt;code&gt;asterisk -rx &amp;quot;database put temperature current 60&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Write the contents to a relational database such as MySQL and use func_odbc:  &lt;code&gt;Set(TEMPERATURE=${ODBC_TEMP()})&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Setup a webpage and parse it with curl: &lt;code&gt;Set(TEMPERATURE=${CURL(http://website.tld/temperature.php)})&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;On Asterisk 1.6, there is the SHELL() function: &lt;code&gt;Set(TEMPERATURE=${SHELL(cat /tmp/current_temperature.txt)})&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I particularly like the curl solution since it allows the script to lookup the temperature when the CURL() function calls it, which means it can be real time and not delayed like writing to a text file can be.&lt;/p&gt;

&lt;p&gt;So like with all things Asterisk, there are always many inventive ways to solve the same solution.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>